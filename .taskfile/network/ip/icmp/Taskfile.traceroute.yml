---
version: '3'

tasks:
  default:
    desc: traceroute (IPv4)
    summary: "task -g traceroute HOST=1.1.1.1"
    platforms: [linux]
    requires:
      vars: [HOST]
    cmds:
      - traceroute -n {{.HOST}}

  icmp:
    desc: traceroute (ICMP mode)
    summary: "task -g traceroute:icmp HOST=1.1.1.1"
    platforms: [linux]
    requires:
      vars: [HOST]
    cmds:
      # -I: 使用 ICMP 探测
      - traceroute -I -n {{.HOST}}

  tcp:
    desc: traceroute (TCP SYN)
    summary: "task -g traceroute:tcp HOST=1.1.1.1 [PORT=443]"
    platforms: [linux]
    requires:
      vars: [HOST]
    vars:
      # PORT 为目的端口（TCP SYN）
      PORT: '{{.PORT | default "443"}}'
    cmds:
      - traceroute -T -p {{.PORT}} -n {{.HOST}}

  darwin:
    desc: traceroute (IPv4, darwin)
    summary: "task -g traceroute:darwin HOST=1.1.1.1"
    platforms: [darwin]
    requires:
      vars: [HOST]
    cmds:
      # darwin traceroute 不支持 -n
      - traceroute {{.HOST}}

  icmp:darwin:
    desc: traceroute (ICMP mode, darwin)
    summary: "task -g traceroute:icmp:darwin HOST=1.1.1.1"
    platforms: [darwin]
    requires:
      vars: [HOST]
    cmds:
      # -I: 使用 ICMP 探测
      - traceroute -I {{.HOST}}
