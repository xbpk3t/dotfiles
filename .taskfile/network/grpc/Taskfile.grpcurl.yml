---
version: '3'

tasks:
  list:
    desc: grpcurl list services
    summary: "task -g list TARGET=<host:port>"
    vars:
      TARGET: ''
    platforms: [linux, darwin]
    requires:
      vars: [TARGET]
    preconditions:
      - sh: command -v grpcurl
        msg: grpcurl not found
    cmds:
      - grpcurl {{.TARGET}} list

  describe:
    desc: grpcurl describe service
    summary: "task -g describe TARGET=<host:port> SERVICE=<svc>"
    vars:
      SERVICE: ''
      TARGET: ''
    platforms: [linux, darwin]
    requires:
      vars: [TARGET, SERVICE]
    preconditions:
      - sh: command -v grpcurl
        msg: grpcurl not found
    cmds:
      - grpcurl {{.TARGET}} describe {{.SERVICE}}

  call:
    desc: grpcurl call method
    summary: "task -g call TARGET=<host:port> METHOD=<svc/method> DATA=<json>"
    vars:
      DATA: ''
      METHOD: ''
      TARGET: ''
    platforms: [linux, darwin]
    requires:
      vars: [TARGET, METHOD, DATA]
    preconditions:
      - sh: command -v grpcurl
        msg: grpcurl not found
    cmds:
      # DATA 为 JSON 字符串
      - grpcurl -d '{{.DATA}}' {{.TARGET}} {{.METHOD}}
