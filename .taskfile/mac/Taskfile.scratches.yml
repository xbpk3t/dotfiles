---
version: '3'

vars:
  SCRATCH_NOTEBOOK: scratch


# FIXME[2026-01-26](fzf): 用 fzf 代替 gum filter. 现在这个gum也能用，但是无法直接preview里面的内容。目前是title和content都堆在一起了。但是fzf现在有问题，fzf会有两层，需要退出两次才能回到terminal，不确定怎没处理

tasks:
  _nb:ensure:
    internal: true
    silent: true
    interactive: true
    preconditions:
      - sh: command -v nb
        msg: "nb not found"

  _nb:ensure_picker:
    internal: true
    silent: true
    interactive: true
    preconditions:
      - sh: command -v gum
        msg: "gum is required"

  new:
    desc: "Create a scratch file and open in Zed"
    silent: true
    interactive: true
    requires:
      vars:
        - SCRATCH_NOTEBOOK
    cmds:
      - task: _nb:ensure
      - task: _nb:ensure_picker
      - '{{.TASKFILE_DIR}}/scripts/scratches/new.sh "{{.SCRATCH_NOTEBOOK}}"'

  list:
    desc: "List scratch files and open selection in Zed"
    silent: true
    interactive: true
    requires:
      vars:
        - SCRATCH_NOTEBOOK
    cmds:
      - task: _nb:ensure
      - task: _nb:ensure_picker
      - '{{.TASKFILE_DIR}}/scripts/scratches/list.sh "{{.SCRATCH_NOTEBOOK}}"'

  search:
    desc: "Search scratch files and open selection in Zed"
    silent: true
    interactive: true
    requires:
      vars:
        - SCRATCH_NOTEBOOK
    cmds:
      - task: _nb:ensure
      - task: _nb:ensure_picker
      - '{{.TASKFILE_DIR}}/scripts/scratches/search.sh "{{.SCRATCH_NOTEBOOK}}"'

  rename:
    desc: "Rename a scratch file"
    silent: true
    interactive: true
    requires:
      vars:
        - SCRATCH_NOTEBOOK
    cmds:
      - task: _nb:ensure
      - task: _nb:ensure_picker
      - '{{.TASKFILE_DIR}}/scripts/scratches/rename.sh "{{.SCRATCH_NOTEBOOK}}"'

  delete:
    desc: "Delete a scratch file"
    silent: true
    interactive: true
    requires:
      vars:
        - SCRATCH_NOTEBOOK
    cmds:
      - task: _nb:ensure
      - task: _nb:ensure_picker
      - '{{.TASKFILE_DIR}}/scripts/scratches/delete.sh "{{.SCRATCH_NOTEBOOK}}"'
