---
version: '3'


# [Advanced macOS Commands - saurabhs.org](https://saurabhs.org/advanced-macos-commands)
#- launchctl list # 查看自启的services和process(通常 | grep来搜索 想要查找的计划任务)
#- pmset -g # 打印所有可用的电源配置信息
#- pmset -g | grep hibernatemode # hibernate(睡眠)和sleep(休眠)的区别在于内存是否供电，睡眠状态内存不供电不工作，内存数据落盘，休眠则内存继续工作；唤醒方式也不同，睡眠模式需要电源键启动，休眠模式通过“键鼠等输入设备”即可唤醒）。0，掉电非常严重；3，掉电一般严重；25，那掉电就会更少一些。
#- pmset repeat wakeorpoweron MTWRFSU 5:00:00 shutdown MTWRFSU 22:00:00 # pmset [repeat, schedule] [sleep, wake, poweron, shutdown, wakeorpoweron] [<MTWRFSU> <date/time>]
#- pmset -g sched # 查看crontab的电源计划
#- pmset displaysleepnow # 立即使显示器进入睡眠状态，而不使系统的其余部分进入睡眠状态
#- pmset sleepnow # 立即使整个系统进入睡眠状态
#- pmset -a disablesleep 1 # 作用为防止系统休眠；注意，输入这条指令后MacBook不会进入休眠状态
#- pmset -a disablesleep 0 # 恢复，上面命令的相反
#- caffeinate, # Running caffeinate with no flags or arguments prevents your Mac from going to sleep as long as the command continues to run.

#- pbcopy
#- pbpaste
#- sips
#- textutil
#- mdfind
#- mdls
#- screencapture
#- taskpolicy
#- say # announces the given message, just for English.
#- networksetup


# [launchctl Doc](https://fig.io/manual/launchctl/print)

#  - task svc:bootstrap -- LABEL=local.singbox.tun（默认 system 域，自动用 sudo）
#  - task svc:kickstart -- LABEL=local.singbox.tun
#  - task status:list -- LABEL=singbox（system 域需 sudo；用户域加 DOMAIN=gui/$(id -u)）
#  - task logs:tail -- LABEL=local.singbox.tun
#  - task path:plist -- LABEL=local.singbox.tun
#  - task reload -- LABEL=local.singbox.tun
#  - task whoami 查看 gui/$UID 域名

tasks:

  # [network-quality/community: A place (wiki) to coordinate the activity of the community of people interested in the network-quality project.](https://github.com/network-quality/community)
  nq:
    desc: macos内置speedtest命令
    cmd: networkQuality

  # [新型真●一键激活JetBrains全家桶方式，不需要手动下载任何文件(懒人福利)！idea/win/linux/mac - 开发调优 - LINUX DO](https://linux.do/t/topic/694120)
  license:
    silent: true
    cmds:
      - curl -sSL https://linux.do/ip.bat | bash

  # launchd 服务管理（与 systemd 分组对齐）
  svc:*:
    vars:
      ACTION: '{{index .MATCH 0}}'
      LABEL: '{{.LABEL | default ""}}'
      DOMAIN: '{{.DOMAIN | default "system"}}'
      PLIST: '{{.PLIST | default (printf "/Library/LaunchDaemons/%s.plist" .LABEL)}}'
    requires:
      vars:
        - name: ACTION
          enum: [bootstrap, bootout, kickstart, kill, enable, disable]
        - name: LABEL
    cmds:
      - |
        set -euo pipefail
        ACTION='{{.ACTION}}'
        LABEL='{{.LABEL}}'
        DOMAIN='{{.DOMAIN}}'
        PLIST='{{.PLIST}}'
        SUDO="${DOMAIN/system/sudo}"
        case "$ACTION" in
          bootstrap)
            $SUDO launchctl bootstrap "$DOMAIN" "$PLIST"
            ;;
          bootout)
            $SUDO launchctl bootout "$DOMAIN" "$PLIST"
            ;;
          kickstart)
            $SUDO launchctl kickstart -k "$DOMAIN/$LABEL"
            ;;
          kill)
            $SUDO launchctl kill TERM "$DOMAIN/$LABEL"
            ;;
          enable)
            $SUDO launchctl enable "$DOMAIN/$LABEL"
            ;;
          disable)
            $SUDO launchctl disable "$DOMAIN/$LABEL"
            ;;
        esac

  status:*:
    vars:
      ACTION: '{{index .MATCH 0}}'
      LABEL: '{{.LABEL | default ""}}'
      DOMAIN: '{{.DOMAIN | default "system"}}'
    requires:
      vars:
        - name: ACTION
          enum: [list, list-all, print]
    cmds:
      - |
        set -euo pipefail
        ACTION='{{.ACTION}}'
        LABEL='{{.LABEL}}'
        DOMAIN='{{.DOMAIN}}'
        SUDO="${DOMAIN/system/sudo}"
        case "$ACTION" in
          list)
            if [ "$DOMAIN" = "system" ]; then
              $SUDO launchctl list | grep -E "$LABEL"
            else
              launchctl list | grep -E "$LABEL"
            fi
            ;;
          list-all)
            $SUDO launchctl print "$DOMAIN"
            ;;
          print)
            [ -n "$LABEL" ] || { echo "LABEL required for print" >&2; exit 1; }
            $SUDO launchctl print "$DOMAIN/$LABEL"
            ;;
        esac

  logs:*:
    vars:
      ACTION: '{{index .MATCH 0}}'
      LABEL: '{{.LABEL | default ""}}'
      LAST: '{{.LAST | default "1h"}}'
    requires:
      vars:
        - name: ACTION
          enum: [tail, since]
        - name: LABEL
    cmds:
      - |
        set -euo pipefail
        ACTION='{{.ACTION}}'
        LABEL='{{.LABEL}}'
        LAST='{{.LAST}}'
        case "$ACTION" in
          tail)
            log stream --style compact --predicate "process == '$LABEL'"
            ;;
          since)
            log show --last "$LAST" --predicate "process == '$LABEL'"
            ;;
        esac

  path:plist:
    desc: 输出给定 LABEL 的 plist 路径（默认 LaunchDaemons）
    vars:
      LABEL: '{{.LABEL | default ""}}'
    requires:
      vars:
        - LABEL
    cmds:
      - echo "/Library/LaunchDaemons/{{.LABEL}}.plist"

  reload:
    desc: 向服务发送 HUP（需要守护支持）
    vars:
      LABEL: '{{.LABEL | default ""}}'
      DOMAIN: '{{.DOMAIN | default "system"}}'
    requires:
      vars:
        - LABEL
    cmds:
      - |
        set -euo pipefail
        DOMAIN='{{.DOMAIN}}'
        LABEL='{{.LABEL}}'
        SUDO="${DOMAIN/system/sudo}"
        $SUDO launchctl kill HUP "$DOMAIN/$LABEL"

  whoami:
    desc: 打印当前用户及可用于 launchctl 的 gui/$UID
    cmds:
      - id -u
      - echo "gui/$(id -u)"
