---
version: '3'

# task upload -- -d  # æ˜ç¡®æŒ‡å®šä¸Šä¼ æ–‡ä»¶å¤¹
# task download -- -y  # ä¸‹è½½æ—¶è‡ªåŠ¨è¦†ç›–
# task upload -- -p  # æ˜¾ç¤ºä¼ è¾“è¿›åº¦æ¡


#- trzsz --dragfile ssh <root@ip>
#- trz/tsz -d # ç›´æ¥ä½¿ç”¨trzæ˜¯ä¸æ”¯æŒä¸Šä¼ æ–‡ä»¶å¤¹çš„ï¼Œéœ€è¦åŠ ä¸ª-dæ‰èƒ½
#- trz/tsz -y


tasks:
  # Commented out to prevent auto-execution when included
  default:
    desc: é»˜è®¤ä¸Šä¼ æ“ä½œï¼ˆæ”¯æŒæ–‡ä»¶å¤¹ï¼‰
    summary: "task -g default"
    cmds:
      - task: upload
    preconditions:
      - sh: "command -v trzsz"
        msg: æ£€æµ‹trzsz-goæ˜¯å¦å®‰è£…


  install:
    desc: å®‰è£…trzsz-goï¼ˆé€šè¿‡Homebrewï¼‰
    summary: "task -g install"
    cmds:
      - brew install trzsz-go
    silent: true

  upload:
    desc: æ‰§è¡Œæ–‡ä»¶/æ–‡ä»¶å¤¹ä¸Šä¼ 
    summary: "task -g upload"
    cmds:
      - |
        if command -v trzsz >/dev/null; then
          echo "ğŸš€ ä½¿ç”¨trzä¸Šä¼ æ–‡ä»¶/æ–‡ä»¶å¤¹ (æ”¯æŒæ‹–æ‹½)"
          echo "ğŸ’¡ æç¤º: è¾“å…¥'trz -d'ä¸Šä¼ æ–‡ä»¶å¤¹"
          trz {{if .CLI_ARGS}}{{.CLI_ARGS}}{{else}}-d{{end}}
        else
          echo "âŒ trzszæœªå®‰è£…ï¼Œè¯·å…ˆæ‰§è¡Œï¼štask install"
          exit 1
        fi

  download:
    desc: ä¸‹è½½æ–‡ä»¶/æ–‡ä»¶å¤¹
    summary: "task -g download"
    cmds:
      - |
        if ! command -v trzsz >/dev/null; then
          task install
        fi
        tsz {{if .CLI_ARGS}}{{.CLI_ARGS}}{{else}}-d{{end}}

  connect:
    desc: è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼ˆæ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼‰
    summary: "task -g connect HOST=<host> [USER=root]"
    vars:
      USER: '{{.USER | default "root"}}'
      HOST: '{{.HOST | default ""}}'
    requires:
      vars: [HOST]
    cmds:
      - trzsz --dragfile ssh {{.USER}}@{{.HOST}}
    env:
      USER: "root"
      HOST: "your-server-ip"

  config:
    desc: ç”Ÿæˆé…ç½®æ–‡ä»¶
    summary: "task -g config"
    cmds:
      - |
        cat <<EOL > ~/.trzsz.conf
        # trzszé…ç½®æ–‡ä»¶
        DefaultUploadPath = ~/Downloads
        DefaultDownloadPath = ~/Downloads
        EOL
        echo "âœ… é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ: ~/.trzsz.conf"
