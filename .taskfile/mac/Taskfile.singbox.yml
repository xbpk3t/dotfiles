---
version: '3'


tasks:
  # Create a script to download sing-box configuration with retry logic
  # 独立的配置下载脚本，与 sing-box 主服务解耦
  update-config:
    desc: 下载订阅并原子更新 sing-box 配置（需要 SINGBOX_URL）
    preconditions:
      - sh: command -v curl
        msg: "找不到 curl，可通过 env CURL=... 指定绝对路径"
      - sh: command -v jq
        msg: "找不到 jq，可通过 env JQ=... 指定绝对路径"
    set: [pipefail]
    cmd: nu ./singbox/update-config.nu
