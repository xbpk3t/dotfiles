---
version: "3"

vars:
  USER_MGR: "{{.TASKFILE_DIR}}/scripts/user-manager.sh"

tasks:
  _call:
    internal: true
    platforms: [linux]
    requires:
      vars: [FUNC]
    cmds:
      - cmd: |
          source "{{.USER_MGR}}"
          check_root
          {{.FUNC}}

  create:
    desc: 创建普通用户（交互）
    summary: |
      task -g user:create
    platforms: [linux]
    interactive: true
    cmds:
      - task: _call
        vars: {FUNC: create_user}

  create-admin:
    desc: 创建管理员用户（交互）
    summary: |
      task -g user:create-admin
    platforms: [linux]
    interactive: true
    cmds:
      - task: _call
        vars: {FUNC: create_admin}

  passwd:
    desc: 修改用户密码（交互）
    summary: |
      task -g user:passwd
    platforms: [linux]
    interactive: true
    cmds:
      - task: _call
        vars: {FUNC: change_password}

  list:
    desc: 列出普通用户（UID >= 1000）
    summary: |
      task -g user:list
    platforms: [linux]
    cmds:
      - task: _call
        vars: {FUNC: list_users}

  delete:
    desc: 删除用户（交互）
    summary: |
      task -g user:delete
    platforms: [linux]
    interactive: true
    cmds:
      - task: _call
        vars: {FUNC: delete_user}
