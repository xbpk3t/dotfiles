---
version: '3'

tasks:
  install:
    desc: Install apify-cli globally via npm
    cmds:
      - npm install -g apify-cli
    preconditions:
      - sh: command -v npm
        msg: "npm is required to install apify-cli"

  login:
    desc: Log in to Apify platform
    cmds:
      - apify login
    preconditions:
      - sh: command -v apify
        msg: "apify-cli is not installed. Run 'task install' first."

  init:
    desc: Initialize a new Apify actor project
    cmds:
      - apify init {{.ACTOR_NAME}}
    vars:
      ACTOR_NAME:
        sh: echo "my-actor"  # Default name, override with TASK_ACTOR_NAME=my-custom-name task init
    preconditions:
      - sh: command -v apify
        msg: "apify-cli is not installed. Run 'task install' first."

  run:
    desc: Run the actor locally
    cmds:
      - apify run
    dir: "{{.ACTOR_DIR}}"
    vars:
      ACTOR_DIR:
        sh: echo "."  # Assume current dir, or override with TASK_ACTOR_DIR=path/to/actor task run
    preconditions:
      - sh: command -v apify
        msg: "apify-cli is not installed. Run 'task install' first."
      - test -f apify.json  # Check if it's an Apify project

  push:
    desc: Push the actor to Apify platform
    cmds:
      - apify push
    dir: "{{.ACTOR_DIR}}"
    vars:
      ACTOR_DIR:
        sh: echo "."  # Assume current dir
    preconditions:
      - sh: command -v apify
        msg: "apify-cli is not installed. Run 'task install' first."
      - test -f apify.json

  call:
    desc: Call (run) an actor on Apify platform
    cmds:
      - apify call {{.ACTOR_ID}}
    vars:
      ACTOR_ID:
        sh: echo "username/actor-name"  # Override with TASK_ACTOR_ID=username/actor-name task call
    preconditions:
      - sh: command -v apify
        msg: "apify-cli is not installed. Run 'task install' first."

  logout:
    desc: Log out from Apify platform
    cmds:
      - apify logout
    preconditions:
      - sh: command -v apify
        msg: "apify-cli is not installed. Run 'task install' first."
