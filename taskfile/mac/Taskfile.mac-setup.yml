---
version: '3'

includes:
  brew:
    taskfile: Taskfile.brew.yml
    internal: true
  mac:
    taskfile: Taskfile.mac.yml
    internal: true
  dotbot:
    taskfile: Taskfile.dotbot.yml
    internal: true


tasks:
  default:
    desc: ğŸš€ è‡ªåŠ¨åŒ–setup macOSå¼€å‘ç¯å¢ƒ - å®Œæ•´çš„å¼€å‘ç¯å¢ƒé…ç½®å·¥å…·
    interactive: true
    silent: true
    cmd: |
      SELECTED=$(gum choose "1-dotfiles-setup" "2-brew-setup" "3-macos-config")

      for choice in $SELECTED; do
        case $choice in
          "1-dotfiles-setup") task mac-setup:dotfiles-setup ;;
          "2-brew-setup") task brew:bundle-restore ;;
          "3-macos-config") task mac-setup:macos-config ;;
        esac
      done
#    cmds:
#      - task: dotfiles-setup
#      - task: brew:bundle-restore
#      - task: macos-config


  dotfiles-setup:
    desc: ğŸ“ è®¾ç½® dotfiles é…ç½®ï¼ˆdotbotï¼‰
    # internal: true
    cmds:
      - task: dotbot:clone # æ³¨æ„æ­¤æ—¶ä½¿ç”¨macoså†…ç½®gitæ¥cloneï¼Œåé¢æˆ‘ä»¬ä¼šç”¨brewçš„gitæ›¿æ¢æ‰ã€‚æ‰€ä»¥ä¸å­˜åœ¨â€œé¸¡ç”Ÿè›‹ã€è›‹ç”Ÿé¸¡â€çš„ä¾èµ–å¾ªç¯é—®é¢˜ã€‚
      - task: dotbot:apply


  macos-config:
    # internal: true
    desc: âš™ï¸ é…ç½® macOS ç³»ç»Ÿåå¥½è®¾ç½® (å·²è¿ç§»åˆ° nix-darwin)
    cmds:
      - echo "âš ï¸  macOS ç³»ç»Ÿé…ç½®å·²è¿ç§»åˆ° nix-darwin"
      - echo "è¯·è¿è¡Œ darwin-rebuild switch --flake ~/.config/nix-darwin"

# macOS é…ç½®ä»»åŠ¡å·²è¿ç§»åˆ° nix-darwin
# è¿™äº›ä»»åŠ¡ç°åœ¨é€šè¿‡ nix-darwin çš„ system.defaults é…ç½®
# è¿è¡Œ darwin-rebuild switch --flake ~/.config/nix-darwin æ¥åº”ç”¨é…ç½®
