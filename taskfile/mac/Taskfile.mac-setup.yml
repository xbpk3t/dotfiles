---
version: '3'

includes:
  brew:
    taskfile: Taskfile.brew.yml
    internal: true
  mac:
    taskfile: Taskfile.mac.yml
    internal: true
  dotbot:
    taskfile: Taskfile.dotbot.yml
    internal: true


tasks:
  default:
    desc: ğŸš€ è‡ªåŠ¨åŒ–setup macOSå¼€å‘ç¯å¢ƒ - å®Œæ•´çš„å¼€å‘ç¯å¢ƒé…ç½®å·¥å…·
    interactive: true
    silent: true
    cmd: |
      SELECTED=$(gum choose "1-dotfiles-setup" "2-brew-setup" "3-macos-config")

      for choice in $SELECTED; do
        case $choice in
          "1-dotfiles-setup") task mac-setup:dotfiles-setup ;;
          "2-brew-setup") task brew:bundle-restore ;;
          "3-macos-config") task mac-setup:macos-config ;;
        esac
      done
#    cmds:
#      - task: dotfiles-setup
#      - task: brew:bundle-restore
#      - task: macos-config


  dotfiles-setup:
    desc: ğŸ“ è®¾ç½® dotfiles é…ç½®ï¼ˆdotbotï¼‰
    # internal: true
    cmds:
      - task: dotbot:clone # æ³¨æ„æ­¤æ—¶ä½¿ç”¨macoså†…ç½®gitæ¥cloneï¼Œåé¢æˆ‘ä»¬ä¼šç”¨brewçš„gitæ›¿æ¢æ‰ã€‚æ‰€ä»¥ä¸å­˜åœ¨â€œé¸¡ç”Ÿè›‹ã€è›‹ç”Ÿé¸¡â€çš„ä¾èµ–å¾ªç¯é—®é¢˜ã€‚
      - task: dotbot:apply


  macos-config:
    # internal: true
    desc: âš™ï¸ é…ç½® macOS ç³»ç»Ÿåå¥½è®¾ç½®
    cmds:
      - task: macos-dock
      - task: macos-finder
      - task: macos-keyboard
      - task: macos-trackpad
      - task: macos-security

  macos-dock:
    desc: ğŸ¯ é…ç½® Dock è®¾ç½®
    internal: true
    cmds:
      - echo "ğŸ¯ é…ç½® Dock..."
      # è®¾ç½® Dock å›¾æ ‡å¤§å°
      - defaults write com.apple.dock tilesize -int 4
      # å¯ç”¨ Dock æ”¾å¤§æ•ˆæœ
      - defaults write com.apple.dock magnification -bool false
      - defaults write com.apple.dock largesize -int 32
      # è®¾ç½® Dock ä½ç½®åˆ°å·¦ä¾§
      - defaults write com.apple.dock orientation -string "left"
      # è‡ªåŠ¨éšè— Dock
      - defaults write com.apple.dock autohide -bool true
      - defaults write com.apple.dock autohide-delay -float 0
      # ç§»é™¤æ‰€æœ‰é»˜è®¤åº”ç”¨
      - defaults write com.apple.dock persistent-apps -array
      # é‡å¯ Dock
      - killall Dock

  macos-finder:
    desc: ğŸ“ é…ç½® Finder è®¾ç½®
    internal: true
    cmds:
      - echo "ğŸ“ é…ç½® Finder..."
      # æ˜¾ç¤ºéšè—æ–‡ä»¶
      - defaults write com.apple.finder AppleShowAllFiles -bool true
      # æ˜¾ç¤ºæ–‡ä»¶æ‰©å±•å
      - defaults write NSGlobalDomain AppleShowAllExtensions -bool true
      # æ˜¾ç¤ºè·¯å¾„æ 
      - defaults write com.apple.finder ShowPathbar -bool true
      # æ˜¾ç¤ºçŠ¶æ€æ 
      - defaults write com.apple.finder ShowStatusBar -bool true
      # é»˜è®¤æœç´¢å½“å‰æ–‡ä»¶å¤¹
      - defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"
      # é¿å…åœ¨ç½‘ç»œå·ä¸Šåˆ›å»º .DS_Store æ–‡ä»¶
      - defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
      # é‡å¯ Finder
      - killall Finder

  macos-keyboard:
    desc: âŒ¨ï¸ é…ç½®é”®ç›˜è®¾ç½®
    internal: true
    cmds:
      - echo "âŒ¨ï¸ é…ç½®é”®ç›˜..."
      # è®¾ç½®é”®ç›˜é‡å¤é€Ÿåº¦
      - defaults write NSGlobalDomain KeyRepeat -int 2
      - defaults write NSGlobalDomain InitialKeyRepeat -int 15
      # å¯ç”¨å…¨é”®ç›˜è®¿é—®
      - defaults write NSGlobalDomain AppleKeyboardUIMode -int 3

  macos-trackpad:
    desc: ğŸ–±ï¸ é…ç½®è§¦æ§æ¿è®¾ç½®
    internal: true
    cmds:
      - echo "ğŸ–±ï¸ é…ç½®è§¦æ§æ¿..."
      # å¯ç”¨è½»ç‚¹ç‚¹å‡»
      - defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true
      - defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1
      # å¯ç”¨ä¸‰æŒ‡æ‹–æ‹½
      - defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerDrag -bool true

  macos-security:
    desc: ğŸ”’ é…ç½®å®‰å…¨è®¾ç½®
    internal: true
    cmds:
      - echo "ğŸ”’ é…ç½®å®‰å…¨è®¾ç½®..."
      # è¦æ±‚å¯†ç ç«‹å³ç”Ÿæ•ˆ
      - defaults write com.apple.screensaver askForPassword -int 1
      - defaults write com.apple.screensaver askForPasswordDelay -int 0
      # å¯ç”¨é˜²ç«å¢™
      - sudo defaults write /Library/Preferences/com.apple.alf globalstate -int 1
