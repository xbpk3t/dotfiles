---
version: '3'

includes:
  brew:
    taskfile: Taskfile.brew.yml
    internal: true
  mac:
    taskfile: Taskfile.mac.yml
    internal: true
  dotbot:
    taskfile: Taskfile.dotbot.yml
    internal: true


tasks:
  default:
    desc: 🚀 自动化setup macOS开发环境 - 完整的开发环境配置工具
    interactive: true
    silent: true
    cmd: |
      SELECTED=$(gum choose "1-dotfiles-setup" "2-brew-setup" "3-macos-config")

      for choice in $SELECTED; do
        case $choice in
          "1-dotfiles-setup") task mac-setup:dotfiles-setup ;;
          "2-brew-setup") task brew:bundle-restore ;;
          "3-macos-config") task mac-setup:macos-config ;;
        esac
      done
#    cmds:
#      - task: dotfiles-setup
#      - task: brew:bundle-restore
#      - task: macos-config


  dotfiles-setup:
    desc: 📁 设置 dotfiles 配置（dotbot）
    # internal: true
    cmds:
      - task: dotbot:clone # 注意此时使用macos内置git来clone，后面我们会用brew的git替换掉。所以不存在“鸡生蛋、蛋生鸡”的依赖循环问题。
      - task: dotbot:apply


  macos-config:
    # internal: true
    desc: ⚙️ 配置 macOS 系统偏好设置 (已迁移到 nix-darwin)
    cmds:
      - echo "⚠️  macOS 系统配置已迁移到 nix-darwin"
      - echo "请运行 darwin-rebuild switch --flake ~/.config/nix-darwin"

# macOS 配置任务已迁移到 nix-darwin
# 这些任务现在通过 nix-darwin 的 system.defaults 配置
# 运行 darwin-rebuild switch --flake ~/.config/nix-darwin 来应用配置
