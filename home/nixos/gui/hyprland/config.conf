###############################################################################
# Hyprland config (rebuilt from previous hyprland + current niri prefs)
###############################################################################

# env / cursor
env = XCURSOR_THEME,Bibata-Modern-Classic
env = XCURSOR_SIZE,12
env = HYPRCURSOR_THEME,Bibata-Modern-Classic
env = HYPRCURSOR_SIZE,12
# 确保 Hyprland 会话能找到 ~/.local/bin 里的脚本（fuzzel-clipboard, raffi-gh 等）
env = PATH,/home/luck/.local/bin:$PATH

$mod = SUPER
$terminal = alacritty
$browser = firefox
$launcher = raffi
$clipboard = fuzzel-clipboard
$text_actions = fuzzel-text-actions

monitor=,preferred,auto,1

###############################################################################
# Look & layout
###############################################################################
general {
  layout = dwindle
  gaps_in = 3
  gaps_out = 3
  border_size = 1
  no_focus_fallback = true
  allow_tearing = false
}

decoration {
  rounding = 0
  active_opacity = 1.0
  inactive_opacity = 1.0
  shadow {
    enabled = false
  }
  blur {
    enabled = false
  }
}

# Grouped windows / tabbed layout
# groupbar 在 Hyprland 中默认只在同一组有 2 个以上窗口时显示；单窗口不显示（正好满足需求）。
group {
  # col.border_active = rgba(180, 220, 255, 0.8)
  # col.border_inactive = rgba(160, 160, 160, 0.5)
    col.border_active = rgba(4cb3d4ff)

    col.border_inactive = rgba(b4befecc)
    col.border_locked_active = rgba(ca9ee6ff)
    col.border_locked_inactive = rgba(b4befecc)

  groupbar {
    enabled = true
    font_size = 12
    render_titles = true
    gradients = true
    height = 12
    scrolling = true
  }
}

animations {
  enabled = false
}

misc {
  focus_on_activate = false
  disable_hyprland_logo = true
}

cursor {
  inactive_timeout = 900
  no_warps = false
}

input {
  kb_layout = us
  follow_mouse = 0
  natural_scroll = 0
  touchpad {
    natural_scroll = 1
    scroll_factor = 0.6
    clickfinger_behavior = true
    disable_while_typing = true
    tap-to-click = true
    tap-and-drag = true
    drag_lock = 2
    drag_3fg = 1
    middle_button_emulation = true
  }
  force_no_accel = 1
  numlock_by_default = 1
}

###############################################################################
# Window rules
###############################################################################
windowrulev2 = float, title:^(Picture-in-Picture)$, class:^(firefox)$
windowrulev2 = float, class:^(wlogout)$
windowrulev2 = move 0 0, class:^(wlogout)$
windowrulev2 = size 100% 100%, class:^(wlogout)$
windowrulev2 = animation slide, class:^(wlogout)$

# Keep cursor theme consistent inside Hyprland

###############################################################################
# Exec at start
###############################################################################
# Start-once programs (one line per command to avoid hyprlang list parsing quirks)
exec-once = fcitx5 -d --replace
exec-once = /usr/lib/mate-polkit/polkit-mate-authentication-agent-1
exec-once = sunsetr

###############################################################################
# Mouse bindings
###############################################################################
bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow

###############################################################################
# Key bindings
###############################################################################
# System
bind = $mod, Q, killactive

# Launchers / utils
bind = $mod, D, exec, $launcher
bind = $mod SHIFT, D, exec, fuzzel
bind = $mod SHIFT, C, exec, $clipboard
bind = $mod SHIFT, G, exec, raffi-gh
bind = $mod, backslash, exec, $text_actions

# Window focus
bind = $mod, left, movefocus, l
bind = $mod, right, movefocus, r
bind = $mod, up, movefocus, u
bind = $mod, down, movefocus, d

# Window move
bind = $mod SHIFT, left, movewindow, l
bind = $mod SHIFT, right, movewindow, r
bind = $mod SHIFT, up, movewindow, u
bind = $mod SHIFT, down, movewindow, d

# Resize
bind = $mod CTRL, left, resizeactive, -20 0
bind = $mod CTRL, right, resizeactive, 20 0
bind = $mod CTRL, up, resizeactive, 0 -20
bind = $mod CTRL, down, resizeactive, 0 20

# Fullscreen
bind = $mod, F, fullscreen

# Tabbed / grouped windows（切换/调整都用这里）
bind = $mod, T, togglegroup
bind = $mod SHIFT, T, moveintogroup
bind = $mod CTRL, T, moveoutofgroup
# 组内前后切换，覆写到 $mod+Tab / $mod+Shift+Tab，同时提供左右键
bind = $mod, tab, changegroupactive, f
bind = $mod SHIFT, tab, changegroupactive, b
bind = $mod CTRL, right, changegroupactive, f
bind = $mod CTRL, left, changegroupactive, b
# 组内调序
bind = $mod ALT, right, movegroupwindow, f
bind = $mod ALT, left, movegroupwindow, b
# 保留全局窗口循环（跨组/未分组），放到 $mod+Alt+Tab
bind = $mod ALT, tab, cyclenext
bind = $mod ALT SHIFT, tab, cyclenext, prev

# Clipboard / text actions already above

# Screenshots
bind = , Print, exec, flameshot full
bind = $mod, Print, exec, "flameshot gui"

# Volume
bind = , F2, exec, pactl set-sink-volume @DEFAULT_SINK@ -10% && notify-send -t 800 -a Volume "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"
bind = , F3, exec, pactl set-sink-volume @DEFAULT_SINK@ +10% && notify-send -t 800 -a Volume "$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"

# Lock
bind = CTRL ALT, L, exec, swaylock

# Clipboard manager manual trigger kept above

###############################################################################
# Misc
###############################################################################
# Keep Xwayland DPI reasonable if launched directly
env = GDK_DPI_SCALE,1.0
