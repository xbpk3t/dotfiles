version: '3'

vars:
  NIX_DIR: '.'

tasks:
  default:
    desc: "è¿è¡Œæ‰€æœ‰ Nix linting å·¥å…·"
    cmds:
      - task: lint

  lint:
    desc: "è¿è¡Œæ‰€æœ‰ Nix linting å·¥å…·"
    dir: '{{.NIX_DIR}}'
    cmds:
      - task: deadnix
      - task: statix
      - task: hammering

  deadnix:
    desc: "ä½¿ç”¨ deadnix æ£€æµ‹æœªä½¿ç”¨çš„ Nix ä»£ç "
    dir: '{{.NIX_DIR}}'
    cmds:
      - echo "ğŸ” è¿è¡Œ deadnix æ£€æŸ¥æœªä½¿ç”¨çš„ Nix ä»£ç ..."
      - deadnix .
      - echo "âœ… deadnix æ£€æŸ¥å®Œæˆ"

  statix:
    desc: "ä½¿ç”¨ statix åˆ†æå’Œä¿®å¤ Nix ä»£ç "
    dir: '{{.NIX_DIR}}'
    cmds:
      - echo "ğŸ” è¿è¡Œ statix åˆ†æ Nix ä»£ç ..."
      - statix check .
      - echo "âœ… statix æ£€æŸ¥å®Œæˆ"

  hammering:
    desc: "ä½¿ç”¨ nixpkgs-hammering æ£€æŸ¥ Nix è¡¨è¾¾å¼"
    dir: '{{.NIX_DIR}}'
    cmds:
      - echo "ğŸ” è¿è¡Œ nixpkgs-hammering æ£€æŸ¥ Nix è¡¨è¾¾å¼..."
      - nix run github:jtojnar/nixpkgs-hammering .
      - echo "âœ… nixpkgs-hammering æ£€æŸ¥å®Œæˆ"

  fix:
    desc: "è‡ªåŠ¨ä¿®å¤å¯ä¿®å¤çš„ Nix ä»£ç é—®é¢˜"
    dir: '{{.NIX_DIR}}'
    cmds:
      - echo "ğŸ”§ è¿è¡Œ statix è‡ªåŠ¨ä¿®å¤..."
      - statix fix .
      - echo "âœ… è‡ªåŠ¨ä¿®å¤å®Œæˆ"

  install-tools:
    desc: "å®‰è£…æ‰€æœ‰ Nix linting å·¥å…·"
    cmds:
      - echo "ğŸ“¦ å®‰è£… Nix linting å·¥å…·..."
      - nix-env -iA nixpkgs.deadnix nixpkgs.statix
      - echo "âœ… å·¥å…·å®‰è£…å®Œæˆ"